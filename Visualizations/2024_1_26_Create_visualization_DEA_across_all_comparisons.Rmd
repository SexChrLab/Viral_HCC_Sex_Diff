---
title: "2024_1_26_Create_visualization_DEA_across_all_comparisons"
output: html_document
date: "2024-01-26"
---

**Purpose:** Create all visualizations for the differential expression analyses done in each comparison

**Methods:**

Visualize each of the following comparisons with volcano plots, upset plots, and logFC plots

* Tumor vs. Tumor-adjacent

* Tumor vs. Tumor-adjacent sex stratified

* Tumor vs. Tumor-adjacent viral stratified

* Tumor vs. Tumor-adjacent viral and sex stratified


**Results:**


## Libraries

```{r}
library(ggrepel)
library(ggplot2)
library(UpSetR)
```

## Read in files

```{r}
# Tumor tumor-adjacent
tumor_adjacent_uf <- as.data.frame(read.csv("~/3.0 Hasting Research/Liver Cancer Analysis/DEGs/tumor_tumor_adj_p1_lfc0.csv"))
tumor_adjacent <- as.data.frame(read.csv("~/3.0 Hasting Research/Liver Cancer Analysis/DEGs/tumor_tumor_adj_p0.05_lfc2.csv"))

# Female tumor tumor-adjacent
tumor_adjacent_F_uf <- as.data.frame(read.csv("~/3.0 Hasting Research/Liver Cancer Analysis/DEGs/female_tumor_tumor_adj_p1_lfc0.csv"))
tumor_adjacent_F <- as.data.frame(read.csv("~/3.0 Hasting Research/Liver Cancer Analysis/DEGs/female_tumor_tumor_adj_p0.05_lfc2.csv"))
colnames(tumor_adjacent_F) <- colnames(tumor_adjacent)

# Male tumor tumor-adjacent
tumor_adjacent_M_uf <- as.data.frame(read.csv("~/3.0 Hasting Research/Liver Cancer Analysis/DEGs/male_tumor_tumor_adj_p1_lfc0.csv"))
tumor_adjacent_M <- as.data.frame(read.csv("~/3.0 Hasting Research/Liver Cancer Analysis/DEGs/male_tumor_tumor_adj_p0.05_lfc2.csv"))
colnames(tumor_adjacent_M) <- colnames(tumor_adjacent)

# HBV tumor tumor-adjacent
tumor_adjacent_HBV_uf <- as.data.frame(read.csv("~/3.0 Hasting Research/Liver Cancer Analysis/DEGs/HBV_tumor_tumor_adj_p1_lfc0.csv"))
tumor_adjacent_HBV <- as.data.frame(read.csv("~/3.0 Hasting Research/Liver Cancer Analysis/DEGs/HBV_tumor_tumor_adj_p0.05_lfc2.csv"))
colnames(tumor_adjacent_HBV) <- colnames(tumor_adjacent)

# HCV tumor tumor-adjacent
tumor_adjacent_HCV_uf <- as.data.frame(read.csv("~/3.0 Hasting Research/Liver Cancer Analysis/DEGs/HCV_tumor_tumor_adj_p1_lfc0.csv"))
tumor_adjacent_HCV <- as.data.frame(read.csv("~/3.0 Hasting Research/Liver Cancer Analysis/DEGs/HBV_tumor_tumor_adj_p0.05_lfc2.csv"))
colnames(tumor_adjacent_HCV) <- colnames(tumor_adjacent)

# F HBV tumor tumor-adjacent
tumor_adjacent_F_HBV_uf <- as.data.frame(read.csv("~/3.0 Hasting Research/Liver Cancer Analysis/DEGs/female_HBV_tumor_tumor_adj_p1_lfc0.csv"))
tumor_adjacent_F_HBV <- as.data.frame(read.csv("~/3.0 Hasting Research/Liver Cancer Analysis/DEGs/female_HBV_tumor_tumor_adj_p0.05_lfc2.csv"))
colnames(tumor_adjacent_F_HBV) <- colnames(tumor_adjacent)

# F HCV tumor tumor-adjacent
tumor_adjacent_F_HCV_uf <- as.data.frame(read.csv("~/3.0 Hasting Research/Liver Cancer Analysis/DEGs/female_HCV_tumor_tumor_adj_p1_lfc0.csv"))
tumor_adjacent_F_HCV <- as.data.frame(read.csv("~/3.0 Hasting Research/Liver Cancer Analysis/DEGs/female_HBV_tumor_tumor_adj_p0.05_lfc2.csv"))
colnames(tumor_adjacent_F_HCV) <- colnames(tumor_adjacent)

# M HBV tumor tumor-adjacent
tumor_adjacent_M_HBV_uf <- as.data.frame(read.csv("~/3.0 Hasting Research/Liver Cancer Analysis/DEGs/male_HBV_tumor_tumor_adj_p1_lfc0.csv"))
tumor_adjacent_M_HBV <- as.data.frame(read.csv("~/3.0 Hasting Research/Liver Cancer Analysis/DEGs/male_HBV_tumor_tumor_adj_p0.05_lfc2.csv"))
colnames(tumor_adjacent_M_HBV) <- colnames(tumor_adjacent)

# M HCV tumor tumor-adjacent
tumor_adjacent_M_HCV_uf <- as.data.frame(read.csv("~/3.0 Hasting Research/Liver Cancer Analysis/DEGs/male_HCV_tumor_tumor_adj_p1_lfc0.csv"))
tumor_adjacent_M_HCV <- as.data.frame(read.csv("~/3.0 Hasting Research/Liver Cancer Analysis/DEGs/male_HCV_tumor_tumor_adj_p0.05_lfc2.csv"))
colnames(tumor_adjacent_M_HCV) <- colnames(tumor_adjacent)
```

## Volcano plots

### Tumor vs. Tumor_adjacent

```{r}
# Volcano plots of sex-biased gene expression in non-infected, HBV, and HCV cases

# Assigning colors to highlight genes that have an absolute fold change => 2
# and an adjusted p-value =< 0.01

# For no hepatitis
# Finding X and Y linked and autosomal genes, assigning color values
tumor_adjacent_uf$color <- NA
## Autosomal non-significant
tumor_adjacent_uf[which(!(tumor_adjacent_uf$GENEID %in% tumor_adjacent$DEGs.GENEID) & tumor_adjacent_uf$chr != "chrX" & tumor_adjacent_uf$chr != "chrY"), 15] <- 1
## X-linked non-signifiant
tumor_adjacent_uf[which(!(tumor_adjacent_uf$GENEID %in% tumor_adjacent$DEGs.GENEID) & tumor_adjacent_uf$chr == "chrX"), 15] <- 2
## Y-linked non-significant
tumor_adjacent_uf[which(!(tumor_adjacent_uf$GENEID %in% tumor_adjacent$DEGs.GENEID) & tumor_adjacent_uf$chr == "chrY"), 15] <- 3
## Autosomal significant
tumor_adjacent_uf[which((tumor_adjacent_uf$GENEID %in% tumor_adjacent$DEGs.GENEID) & tumor_adjacent_uf$chr != "chrX" & tumor_adjacent_uf$chr != "chrY"), 15] <- 4
## X-linked signifiant
tumor_adjacent_uf[which((tumor_adjacent_uf$GENEID %in% tumor_adjacent$DEGs.GENEID) & tumor_adjacent_uf$chr == "chrX"), 15] <- 5
## Y-linked significant
tumor_adjacent_uf[which((tumor_adjacent_uf$GENEID %in% tumor_adjacent$DEGs.GENEID) & tumor_adjacent_uf$chr == "chrY"), 15] <- 6


tumor_adjacent_uf$color <- as.factor(tumor_adjacent_uf$color)

# Constructing the plot object. The colors will not work the way they should if
# one of the groups doesn't have any genes
# "azure3", "pink", "seagreen2", "black", "mediumvioletred", "springgreen"
p <- ggplot(data = tumor_adjacent_uf, aes(x = logFC, y = -log10(adj.P.Val), color=color )) +
  geom_point(alpha = 0.5, size = 5) +
  theme_bw() +
  theme(legend.position = "none") +
  xlim(c(-8, 8)) + ylim(c(0, 100)) +
  scale_color_manual(values = c("azure3", "pink", "seagreen2", "black", "mediumvioletred", "springgreen")) +
  labs(x=expression(log[2](FC)),
       y=expression(-log[10] ~ "(FDR-adjusted " ~ italic("p") ~ "-value)")) +
  theme(axis.title.x=element_text(size=12), 
        axis.text.x=element_text(size=10)) +
  theme(axis.title.y=element_text(size=12),
        axis.text.y=element_text(size=10))

forLabel <- subset(tumor_adjacent_uf, adj.P.Val<=0.01 & abs(logFC)>=2)

# Adding lines for significance thresholds
p + geom_hline(yintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = -2, colour="#000000", linetype="dashed"
) + geom_text_repel(data=forLabel, max.iter=1000, box.padding = 0.25, force=1, aes(x = logFC, y = -log10(adj.P.Val), label=gene_name, color=color), size=9)


pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/Tumor_adjacent_volcano.pdf", width=12, height=12)
p + geom_hline(yintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = -2, colour="#000000", linetype="dashed"
) + geom_text_repel(data=forLabel, max.iter=1000, box.padding = 0.25, force=1, aes(x = logFC, y = -log10(adj.P.Val), label=gene_name, color=color), size=9)
dev.off()
```

### Female Tumor vs. Tumor_adjacent

```{r}
# Volcano plots of sex-biased gene expression in non-infected, HBV, and HCV cases

# Assigning colors to highlight genes that have an absolute fold change => 2
# and an adjusted p-value =< 0.01

# For no hepatitis
# Finding X and Y linked and autosomal genes, assigning color values
tumor_adjacent_F_uf$color <- NA
## Autosomal non-significant
tumor_adjacent_F_uf[which(!(tumor_adjacent_F_uf$GENEID %in% tumor_adjacent_F$DEGs.GENEID) & tumor_adjacent_F_uf$chr != "chrX" & tumor_adjacent_F_uf$chr != "chrY"), 15] <- 1
## X-linked non-signifiant
tumor_adjacent_F_uf[which(!(tumor_adjacent_F_uf$GENEID %in% tumor_adjacent_F$DEGs.GENEID) & tumor_adjacent_F_uf$chr == "chrX"), 15] <- 2
## Y-linked non-significant
tumor_adjacent_F_uf[which(!(tumor_adjacent_F_uf$GENEID %in% tumor_adjacent_F$DEGs.GENEID) & tumor_adjacent_F_uf$chr == "chrY"), 15] <- 3
## Autosomal significant
tumor_adjacent_F_uf[which((tumor_adjacent_F_uf$GENEID %in% tumor_adjacent_F$DEGs.GENEID) & tumor_adjacent_F_uf$chr != "chrX" & tumor_adjacent_F_uf$chr != "chrY"), 15] <- 4
## X-linked signifiant
tumor_adjacent_F_uf[which((tumor_adjacent_F_uf$GENEID %in% tumor_adjacent_F$DEGs.GENEID) & tumor_adjacent_F_uf$chr == "chrX"), 15] <- 5
## Y-linked significant
tumor_adjacent_F_uf[which((tumor_adjacent_F_uf$GENEID %in% tumor_adjacent_F$DEGs.GENEID) & tumor_adjacent_F_uf$chr == "chrY"), 15] <- 6


tumor_adjacent_F_uf$color <- as.factor(tumor_adjacent_F_uf$color)

# Constructing the plot object. The colors will not work the way they should if
# one of the groups doesn't have any genes
# "azure3", "pink", "seagreen2", "black", "mediumvioletred", "springgreen"
p <- ggplot(data = tumor_adjacent_F_uf, aes(x = logFC, y = -log10(adj.P.Val), color=color )) +
  geom_point(alpha = 0.5, size = 5) +
  theme_bw() +
  theme(legend.position = "none") +
  xlim(c(-8, 8)) + ylim(c(0, 100)) +
  scale_color_manual(values = c("azure3", "pink", "seagreen2", "black", "mediumvioletred", "springgreen")) +
  labs(x=expression(log[2](FC)),
       y=expression(-log[10] ~ "(FDR-adjusted " ~ italic("p") ~ "-value)")) +
  theme(axis.title.x=element_text(size=12), 
        axis.text.x=element_text(size=10)) +
  theme(axis.title.y=element_text(size=12),
        axis.text.y=element_text(size=10))

forLabel <- subset(tumor_adjacent_F_uf, adj.P.Val<=0.01 & abs(logFC)>=2)

# Adding lines for significance thresholds
p + geom_hline(yintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = -2, colour="#000000", linetype="dashed"
) + geom_text_repel(data=forLabel, max.iter=1000, box.padding = 0.25, force=1, aes(x = logFC, y = -log10(adj.P.Val), label=gene_name, color=color), size=9)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/Tumor_adjacent_F_volcano.pdf", width=12, height=12)
p + geom_hline(yintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = -2, colour="#000000", linetype="dashed"
) + geom_text_repel(data=forLabel, max.iter=1000, box.padding = 0.25, force=1, aes(x = logFC, y = -log10(adj.P.Val), label=gene_name, color=color), size=9)
dev.off()
```

### Male Tumor vs. Tumor_adjacent

```{r}
# Volcano plots of sex-biased gene expression in non-infected, HBV, and HCV cases

# Assigning colors to highlight genes that have an absolute fold change => 2
# and an adjusted p-value =< 0.01

# For no hepatitis
# Finding X and Y linked and autosomal genes, assigning color values
tumor_adjacent_M_uf$color <- NA
## Autosomal non-significant
tumor_adjacent_M_uf[which(!(tumor_adjacent_M_uf$GENEID %in% tumor_adjacent_M$DEGs.GENEID) & tumor_adjacent_M_uf$chr != "chrX" & tumor_adjacent_M_uf$chr != "chrY"), 15] <- 1
## X-linked non-signifiant
tumor_adjacent_M_uf[which(!(tumor_adjacent_M_uf$GENEID %in% tumor_adjacent_M$DEGs.GENEID) & tumor_adjacent_M_uf$chr == "chrX"), 15] <- 2
## Y-linked non-significant
tumor_adjacent_M_uf[which(!(tumor_adjacent_M_uf$GENEID %in% tumor_adjacent_M$DEGs.GENEID) & tumor_adjacent_M_uf$chr == "chrY"), 15] <- 3
## Autosomal significant
tumor_adjacent_M_uf[which((tumor_adjacent_M_uf$GENEID %in% tumor_adjacent_M$DEGs.GENEID) & tumor_adjacent_M_uf$chr != "chrX" & tumor_adjacent_M_uf$chr != "chrY"), 15] <- 4
## X-linked signifiant
tumor_adjacent_M_uf[which((tumor_adjacent_M_uf$GENEID %in% tumor_adjacent_M$DEGs.GENEID) & tumor_adjacent_M_uf$chr == "chrX"), 15] <- 5
## Y-linked significant
tumor_adjacent_M_uf[which((tumor_adjacent_M_uf$GENEID %in% tumor_adjacent_M$DEGs.GENEID) & tumor_adjacent_M_uf$chr == "chrY"), 15] <- 6


tumor_adjacent_M_uf$color <- as.factor(tumor_adjacent_M_uf$color)

# Constructing the plot object. The colors will not work the way they should if
# one of the groups doesn't have any genes
# "azure3", "pink", "seagreen2", "black", "mediumvioletred", "springgreen"
p <- ggplot(data = tumor_adjacent_M_uf, aes(x = logFC, y = -log10(adj.P.Val), color=color )) +
  geom_point(alpha = 0.5, size = 5) +
  theme_bw() +
  theme(legend.position = "none") +
  xlim(c(-8, 8)) + ylim(c(0, 100)) +
  scale_color_manual(values = c("azure3", "pink", "seagreen2", "black", "mediumvioletred", "springgreen")) +
  labs(x=expression(log[2](FC)),
       y=expression(-log[10] ~ "(FDR-adjusted " ~ italic("p") ~ "-value)")) +
  theme(axis.title.x=element_text(size=12), 
        axis.text.x=element_text(size=10)) +
  theme(axis.title.y=element_text(size=12),
        axis.text.y=element_text(size=10))

forLabel <- subset(tumor_adjacent_M_uf, adj.P.Val<=0.01 & abs(logFC)>=2)

# Adding lines for significance thresholds
p + geom_hline(yintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = -2, colour="#000000", linetype="dashed"
) + geom_text_repel(data=forLabel, max.iter=1000, box.padding = 0.25, force=1, aes(x = logFC, y = -log10(adj.P.Val), label=gene_name, color=color), size=9)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/Tumor_adjacent_M_volcano.pdf", width=12, height=12)
p + geom_hline(yintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = -2, colour="#000000", linetype="dashed"
) + geom_text_repel(data=forLabel, max.iter=1000, box.padding = 0.25, force=1, aes(x = logFC, y = -log10(adj.P.Val), label=gene_name, color=color), size=9)
dev.off()
```


### HBV Tumor vs. Tumor_adjacent

```{r}
# Volcano plots of sex-biased gene expression in non-infected, HBV, and HCV cases

# Assigning colors to highlight genes that have an absolute fold change => 2
# and an adjusted p-value =< 0.01

# For no hepatitis
# Finding X and Y linked and autosomal genes, assigning color values
tumor_adjacent_HBV_uf$color <- NA
## Autosomal non-significant
tumor_adjacent_HBV_uf[which(!(tumor_adjacent_HBV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_HBV_uf$chr != "chrX" & tumor_adjacent_HBV_uf$chr != "chrY"), 15] <- 1
## X-linked non-signifiant
tumor_adjacent_HBV_uf[which(!(tumor_adjacent_HBV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_HBV_uf$chr == "chrX"), 15] <- 2
## Y-linked non-significant
tumor_adjacent_HBV_uf[which(!(tumor_adjacent_HBV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_HBV_uf$chr == "chrY"), 15] <- 3
## Autosomal significant
tumor_adjacent_HBV_uf[which((tumor_adjacent_HBV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_HBV_uf$chr != "chrX" & tumor_adjacent_HBV_uf$chr != "chrY"), 15] <- 4
## X-linked signifiant
tumor_adjacent_HBV_uf[which((tumor_adjacent_HBV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_HBV_uf$chr == "chrX"), 15] <- 5
## Y-linked significant
tumor_adjacent_HBV_uf[which((tumor_adjacent_HBV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_HBV_uf$chr == "chrY"), 15] <- 6


tumor_adjacent_HBV_uf$color <- as.factor(tumor_adjacent_HBV_uf$color)

# Constructing the plot object. The colors will not work the way they should if
# one of the groups doesn't have any genes
# "azure3", "pink", "seagreen2", "black", "mediumvioletred", "springgreen"
p <- ggplot(data = tumor_adjacent_HBV_uf, aes(x = logFC, y = -log10(adj.P.Val), color=color )) +
  geom_point(alpha = 0.5, size = 5) +
  theme_bw() +
  theme(legend.position = "none") +
  xlim(c(-8, 8)) + ylim(c(0, 100)) +
  scale_color_manual(values = c("azure3", "pink", "seagreen2", "black", "mediumvioletred", "springgreen")) +
  labs(x=expression(log[2](FC)),
       y=expression(-log[10] ~ "(FDR-adjusted " ~ italic("p") ~ "-value)")) +
  theme(axis.title.x=element_text(size=12), 
        axis.text.x=element_text(size=10)) +
  theme(axis.title.y=element_text(size=12),
        axis.text.y=element_text(size=10))

forLabel <- subset(tumor_adjacent_HBV_uf, adj.P.Val<=0.01 & abs(logFC)>=2)

# Adding lines for significance thresholds
p + geom_hline(yintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = -2, colour="#000000", linetype="dashed"
) + geom_text_repel(data=forLabel, max.iter=1000, box.padding = 0.25, force=1, aes(x = logFC, y = -log10(adj.P.Val), label=gene_name, color=color), size=9)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/Tumor_adjacent_HBV_volcano.pdf", width=12, height=12)
p + geom_hline(yintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = -2, colour="#000000", linetype="dashed"
) + geom_text_repel(data=forLabel, max.iter=1000, box.padding = 0.25, force=1, aes(x = logFC, y = -log10(adj.P.Val), label=gene_name, color=color), size=9)
dev.off()
```

### HCV Tumor vs. Tumor_adjacent

```{r}
# Volcano plots of sex-biased gene expression in non-infected, HBV, and HCV cases

# Assigning colors to highlight genes that have an absolute fold change => 2
# and an adjusted p-value =< 0.01

# For no hepatitis
# Finding X and Y linked and autosomal genes, assigning color values
tumor_adjacent_HCV_uf$color <- NA
## Autosomal non-significant
tumor_adjacent_HCV_uf[which(!(tumor_adjacent_HCV_uf$GENEID %in% tumor_adjacent_HCV$DEGs.GENEID) & tumor_adjacent_HCV_uf$chr != "chrX" & tumor_adjacent_HCV_uf$chr != "chrY"), 15] <- 1
## X-linked non-signifiant
tumor_adjacent_HCV_uf[which(!(tumor_adjacent_HCV_uf$GENEID %in% tumor_adjacent_HCV$DEGs.GENEID) & tumor_adjacent_HCV_uf$chr == "chrX"), 15] <- 2
## Y-linked non-significant
tumor_adjacent_HCV_uf[which(!(tumor_adjacent_HCV_uf$GENEID %in% tumor_adjacent_HCV$DEGs.GENEID) & tumor_adjacent_HCV_uf$chr == "chrY"), 15] <- 3
## Autosomal significant
tumor_adjacent_HCV_uf[which((tumor_adjacent_HCV_uf$GENEID %in% tumor_adjacent_HCV$DEGs.GENEID) & tumor_adjacent_HCV_uf$chr != "chrX" & tumor_adjacent_HCV_uf$chr != "chrY"), 15] <- 4
## X-linked signifiant
tumor_adjacent_HCV_uf[which((tumor_adjacent_HCV_uf$GENEID %in% tumor_adjacent_HCV$DEGs.GENEID) & tumor_adjacent_HCV_uf$chr == "chrX"), 15] <- 5
## Y-linked significant
tumor_adjacent_HCV_uf[which((tumor_adjacent_HCV_uf$GENEID %in% tumor_adjacent_HCV$DEGs.GENEID) & tumor_adjacent_HCV_uf$chr == "chrY"), 15] <- 6


tumor_adjacent_HCV_uf$color <- as.factor(tumor_adjacent_HCV_uf$color)

# Constructing the plot object. The colors will not work the way they should if
# one of the groups doesn't have any genes
# "azure3", "pink", "seagreen2", "black", "mediumvioletred", "springgreen"
p <- ggplot(data = tumor_adjacent_HCV_uf, aes(x = logFC, y = -log10(adj.P.Val), color=color )) +
  geom_point(alpha = 0.5, size = 5) +
  theme_bw() +
  theme(legend.position = "none") +
  xlim(c(-8, 8)) + ylim(c(0, 100)) +
  scale_color_manual(values = c("azure3", "pink", "seagreen2", "black", "mediumvioletred", "springgreen")) +
  labs(x=expression(log[2](FC)),
       y=expression(-log[10] ~ "(FDR-adjusted " ~ italic("p") ~ "-value)")) +
  theme(axis.title.x=element_text(size=12), 
        axis.text.x=element_text(size=10)) +
  theme(axis.title.y=element_text(size=12),
        axis.text.y=element_text(size=10))

forLabel <- subset(tumor_adjacent_HCV_uf, adj.P.Val<=0.01 & abs(logFC)>=2)

# Adding lines for significance thresholds
p + geom_hline(yintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = -2, colour="#000000", linetype="dashed"
) + geom_text_repel(data=forLabel, max.iter=1000, box.padding = 0.25, force=1, aes(x = logFC, y = -log10(adj.P.Val), label=gene_name, color=color), size=9)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/Tumor_adjacent_HCV_volcano.pdf", width=12, height=12)
p + geom_hline(yintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = -2, colour="#000000", linetype="dashed"
) + geom_text_repel(data=forLabel, max.iter=1000, box.padding = 0.25, force=1, aes(x = logFC, y = -log10(adj.P.Val), label=gene_name, color=color), size=9)
dev.off()
```

# Upset plots

# Male vs. female

```{r}
upset_list <- list("Up Overall"= tumor_adjacent_uf[which(tumor_adjacent_uf$adj.P.Val<0.05 & tumor_adjacent_uf$logFC>0),1], 
                   "Up Female"=tumor_adjacent_F_uf[which(tumor_adjacent_F_uf$adj.P.Val<0.05 & tumor_adjacent_F_uf$logFC>0),1],
                   "Up Male"=tumor_adjacent_M_uf[which(tumor_adjacent_M_uf$adj.P.Val<0.05 & tumor_adjacent_M_uf$logFC>0),1],
                   "Down Overall"= tumor_adjacent_uf[which(tumor_adjacent_uf$adj.P.Val<0.05 & tumor_adjacent_uf$logFC<0),1], 
                   "Down Female"=tumor_adjacent_F_uf[which(tumor_adjacent_F_uf$adj.P.Val<0.05 & tumor_adjacent_F_uf$logFC<0),1],
                   "Down Male"=tumor_adjacent_M_uf[which(tumor_adjacent_M_uf$adj.P.Val<0.05 & tumor_adjacent_M_uf$logFC<0),1])
upset(fromList(upset_list), order.by = "freq", sets=c("Up Overall", "Up Female", "Up Male",
                                                      "Down Overall", "Down Female", "Down Male"), nsets=6, keep.order = TRUE)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/Tumor_adjacent_Male_Female_Upset.pdf", width=10, height=10)
upset(fromList(upset_list), order.by = "freq", sets=c("Up Overall", "Up Female", "Up Male",
                                                      "Down Overall", "Down Female", "Down Male"), nsets=6, keep.order = TRUE)
dev.off()
```

## Upset plots HBV HCV

```{r}
upset_list <- list("Up Overall"= tumor_adjacent_uf[which(tumor_adjacent_uf$adj.P.Val<0.05 & tumor_adjacent_uf$logFC>0),1], 
                   "Up HBV"=tumor_adjacent_HBV_uf[which(tumor_adjacent_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_HBV_uf$logFC>0),1],
                   "Up HCV"=tumor_adjacent_HCV_uf[which(tumor_adjacent_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_HCV_uf$logFC>0),1],
                   "Down Overall"= tumor_adjacent_uf[which(tumor_adjacent_uf$adj.P.Val<0.05 & tumor_adjacent_uf$logFC<0),1], 
                   "Down HBV"=tumor_adjacent_HBV_uf[which(tumor_adjacent_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_HBV_uf$logFC<0),1],
                   "Down HCV"=tumor_adjacent_HCV_uf[which(tumor_adjacent_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_HCV_uf$logFC<0),1])
upset(fromList(upset_list), order.by = "freq", sets=c("Up Overall", "Up HBV", "Up HCV",
                                                      "Down Overall", "Down HBV", "Down HCV"), nsets=6, keep.order = TRUE)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/Tumor_adjacent_HBV_HCV_Upset.pdf", width=10, height=10)
upset(fromList(upset_list), order.by = "freq", sets=c("Up Overall", "Up HBV", "Up HCV",
                                                      "Down Overall", "Down HBV", "Down HCV"), nsets=6, keep.order = TRUE)
dev.off()
```


# LogFC plots

## LogFC Male vs. Female
```{r}
tumor_adjacent_M_uf <- tumor_adjacent_M_uf[match(tumor_adjacent_F_uf$GENEID, tumor_adjacent_M_uf$GENEID),]
identical(tumor_adjacent_F_uf$GENEID, tumor_adjacent_M_uf$GENEID)

plot(tumor_adjacent_M_uf$logFC, tumor_adjacent_F_uf$logFC, type="n")
abline(h=0, col="darkgray", lty=3)
abline(v=0, col="darkgray", lty=3)
points(tumor_adjacent_M_uf$logFC, tumor_adjacent_F_uf$logFC, 
     col=ifelse(tumor_adjacent_M_uf$adj.P.Val>=0.05 & tumor_adjacent_F_uf$adj.P.Val>=0.05, "black",
                ifelse(tumor_adjacent_M_uf$adj.P.Val<0.05 & tumor_adjacent_F_uf$adj.P.Val>0.05,"blue",
                       ifelse(tumor_adjacent_M_uf$adj.P.Val>0.05 & tumor_adjacent_F_uf$adj.P.Val<0.05, "maroon",
                              ifelse(tumor_adjacent_M_uf$adj.P.Val<0.05 & tumor_adjacent_F_uf$adj.P.Val<0.05, "goldenrod", "red")))))
#legend("topleft", pch=c(1), 
#       col=c("black", "blue", "maroon", "goldenrod"),
#       legend=c("Not significant", "Signficiant males only", "Significant Females only", "Signfiicant Males and Females"))

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/Tumor_adjacent_Male_Female_LogFC.pdf", width=7, height=7)
tumor_adjacent_M_uf <- tumor_adjacent_M_uf[match(tumor_adjacent_F_uf$GENEID, tumor_adjacent_M_uf$GENEID),]
identical(tumor_adjacent_F_uf$GENEID, tumor_adjacent_M_uf$GENEID)

plot(tumor_adjacent_M_uf$logFC, tumor_adjacent_F_uf$logFC, type="n")
abline(h=0, col="darkgray", lty=3)
abline(v=0, col="darkgray", lty=3)
points(tumor_adjacent_M_uf$logFC, tumor_adjacent_F_uf$logFC, 
     col=ifelse(tumor_adjacent_M_uf$adj.P.Val>=0.05 & tumor_adjacent_F_uf$adj.P.Val>=0.05, "black",
                ifelse(tumor_adjacent_M_uf$adj.P.Val<0.05 & tumor_adjacent_F_uf$adj.P.Val>0.05,"blue",
                       ifelse(tumor_adjacent_M_uf$adj.P.Val>0.05 & tumor_adjacent_F_uf$adj.P.Val<0.05, "maroon",
                              ifelse(tumor_adjacent_M_uf$adj.P.Val<0.05 & tumor_adjacent_F_uf$adj.P.Val<0.05, "goldenrod", "red")))))
dev.off()
```

## Significnat in both, same direction
```{r}
tumor_adjacent_M_uf_abbr <- tumor_adjacent_M_uf[which((tumor_adjacent_M_uf$adj.P.Val<0.05 & tumor_adjacent_M_uf$logFC>0 & tumor_adjacent_F_uf$adj.P.Val<0.05 & tumor_adjacent_F_uf$logFC>0) | (tumor_adjacent_M_uf$adj.P.Val<0.05 & tumor_adjacent_M_uf$logFC<0 & tumor_adjacent_F_uf$adj.P.Val<0.05 & tumor_adjacent_F_uf$logFC<0)),]
tumor_adjacent_F_uf_abbr <- tumor_adjacent_F_uf[which((tumor_adjacent_M_uf$adj.P.Val<0.05 & tumor_adjacent_M_uf$logFC>0 & tumor_adjacent_F_uf$adj.P.Val<0.05 & tumor_adjacent_F_uf$logFC>0) | (tumor_adjacent_M_uf$adj.P.Val<0.05 & tumor_adjacent_M_uf$logFC<0 & tumor_adjacent_F_uf$adj.P.Val<0.05 & tumor_adjacent_F_uf$logFC<0)),]
identical(tumor_adjacent_F_uf_abbr$GENEID, tumor_adjacent_M_uf_abbr$GENEID)
plot(tumor_adjacent_M_uf$logFC, tumor_adjacent_F_uf$logFC, type="n")
abline(h=0, col="darkgray", lty=3)
abline(v=0, col="darkgray", lty=3)
points(tumor_adjacent_M_uf_abbr$logFC, tumor_adjacent_F_uf_abbr$logFC, 
     col=ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val>=0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val>=0.05, "black",
                ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val<0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val>0.05,"blue",
                       ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val>0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val<0.05, "maroon",
                              ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val<0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val<0.05, "goldenrod", "red")))))

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/Significant_same_dir_LogFC.pdf", width=7, height=7)
plot(tumor_adjacent_M_uf$logFC, tumor_adjacent_F_uf$logFC, type="n")
abline(h=0, col="darkgray", lty=3)
abline(v=0, col="darkgray", lty=3)
points(tumor_adjacent_M_uf_abbr$logFC, tumor_adjacent_F_uf_abbr$logFC, 
     col=ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val>=0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val>=0.05, "black",
                ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val<0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val>0.05,"blue",
                       ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val>0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val<0.05, "maroon",
                              ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val<0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val<0.05, "goldenrod", "red")))))
dev.off()
```
## Significnat in both, opposite direction
```{r}
tumor_adjacent_M_uf_abbr <- tumor_adjacent_M_uf[which((tumor_adjacent_M_uf$adj.P.Val<0.05 & tumor_adjacent_M_uf$logFC>0 & tumor_adjacent_F_uf$adj.P.Val<0.05 & tumor_adjacent_F_uf$logFC<0) | (tumor_adjacent_M_uf$adj.P.Val<0.05 & tumor_adjacent_M_uf$logFC<0 & tumor_adjacent_F_uf$adj.P.Val<0.05 & tumor_adjacent_F_uf$logFC>0)),]
tumor_adjacent_F_uf_abbr <- tumor_adjacent_F_uf[which((tumor_adjacent_M_uf$adj.P.Val<0.05 & tumor_adjacent_M_uf$logFC>0 & tumor_adjacent_F_uf$adj.P.Val<0.05 & tumor_adjacent_F_uf$logFC<0) | (tumor_adjacent_M_uf$adj.P.Val<0.05 & tumor_adjacent_M_uf$logFC<0 & tumor_adjacent_F_uf$adj.P.Val<0.05 & tumor_adjacent_F_uf$logFC>0)),]
identical(tumor_adjacent_F_uf_abbr$GENEID, tumor_adjacent_M_uf_abbr$GENEID)
plot(tumor_adjacent_M_uf_abbr$logFC, tumor_adjacent_F_uf_abbr$logFC, type="n")
abline(h=0, col="darkgray", lty=3)
abline(v=0, col="darkgray", lty=3)
points(tumor_adjacent_M_uf_abbr$logFC, tumor_adjacent_F_uf_abbr$logFC, 
     col=ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val>=0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val>=0.05, "black",
                ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val<0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val>0.05,"blue",
                       ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val>0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val<0.05, "maroon",
                              ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val<0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val<0.05, "goldenrod", "red")))))

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/Significant_different_dir_LogFC.pdf", width=7, height=7)
plot(tumor_adjacent_M_uf_abbr$logFC, tumor_adjacent_F_uf_abbr$logFC, type="n")
abline(h=0, col="darkgray", lty=3)
abline(v=0, col="darkgray", lty=3)
points(tumor_adjacent_M_uf_abbr$logFC, tumor_adjacent_F_uf_abbr$logFC, 
     col=ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val>=0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val>=0.05, "black",
                ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val<0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val>0.05,"blue",
                       ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val>0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val<0.05, "maroon",
                              ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val<0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val<0.05, "goldenrod", "red")))))
dev.off()
```

## Significnat in females only
```{r}
tumor_adjacent_M_uf_abbr <- tumor_adjacent_M_uf[which(tumor_adjacent_M_uf$adj.P.Val>=0.05 & tumor_adjacent_F_uf$adj.P.Val<0.05),]
tumor_adjacent_F_uf_abbr <- tumor_adjacent_F_uf[which(tumor_adjacent_M_uf$adj.P.Val>=0.05 & tumor_adjacent_F_uf$adj.P.Val<0.05),]
identical(tumor_adjacent_F_uf_abbr$GENEID, tumor_adjacent_M_uf_abbr$GENEID)
plot(tumor_adjacent_M_uf_abbr$logFC, tumor_adjacent_F_uf_abbr$logFC, type="n")
abline(h=0, col="darkgray", lty=3)
abline(v=0, col="darkgray", lty=3)
points(tumor_adjacent_M_uf_abbr$logFC, tumor_adjacent_F_uf_abbr$logFC, 
     col=ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val>=0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val>=0.05, "black",
                ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val<0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val>0.05,"blue",
                       ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val>0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val<0.05, "maroon",
                              ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val<0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val<0.05, "goldenrod", "red")))))

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/Significant_female_only_LogFC.pdf", width=7, height=7)
plot(tumor_adjacent_M_uf_abbr$logFC, tumor_adjacent_F_uf_abbr$logFC, type="n")
abline(h=0, col="darkgray", lty=3)
abline(v=0, col="darkgray", lty=3)
points(tumor_adjacent_M_uf_abbr$logFC, tumor_adjacent_F_uf_abbr$logFC, 
     col=ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val>=0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val>=0.05, "black",
                ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val<0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val>0.05,"blue",
                       ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val>0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val<0.05, "maroon",
                              ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val<0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val<0.05, "goldenrod", "red")))))
dev.off()
```

## Significnat in males only
```{r}
tumor_adjacent_M_uf_abbr <- tumor_adjacent_M_uf[which(tumor_adjacent_M_uf$adj.P.Val<0.05 & tumor_adjacent_F_uf$adj.P.Val>=0.05),]
tumor_adjacent_F_uf_abbr <- tumor_adjacent_F_uf[which(tumor_adjacent_M_uf$adj.P.Val<0.05 & tumor_adjacent_F_uf$adj.P.Val>=0.05),]
identical(tumor_adjacent_F_uf_abbr$GENEID, tumor_adjacent_M_uf_abbr$GENEID)
plot(tumor_adjacent_M_uf_abbr$logFC, tumor_adjacent_F_uf_abbr$logFC, type="n")
abline(h=0, col="darkgray", lty=3)
abline(v=0, col="darkgray", lty=3)
points(tumor_adjacent_M_uf_abbr$logFC, tumor_adjacent_F_uf_abbr$logFC, 
     col=ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val>=0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val>=0.05, "black",
                ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val<0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val>0.05,"blue",
                       ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val>0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val<0.05, "maroon",
                              ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val<0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val<0.05, "goldenrod", "red")))))

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/Significant_male_only_LogFC.pdf", width=7, height=7)
plot(tumor_adjacent_M_uf_abbr$logFC, tumor_adjacent_F_uf_abbr$logFC, type="n")
abline(h=0, col="darkgray", lty=3)
abline(v=0, col="darkgray", lty=3)
points(tumor_adjacent_M_uf_abbr$logFC, tumor_adjacent_F_uf_abbr$logFC, 
     col=ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val>=0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val>=0.05, "black",
                ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val<0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val>0.05,"blue",
                       ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val>0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val<0.05, "maroon",
                              ifelse(tumor_adjacent_M_uf_abbr$adj.P.Val<0.05 & tumor_adjacent_F_uf_abbr$adj.P.Val<0.05, "goldenrod", "red")))))
dev.off()
```

# LogFC plots HBV and HCV

## Significnat in both, same direction
```{r}
tumor_adjacent_HBV_uf <- tumor_adjacent_HBV_uf[match(tumor_adjacent_HCV_uf$GENEID, tumor_adjacent_HBV_uf$GENEID),]
identical(tumor_adjacent_HBV_uf$GENEID, tumor_adjacent_HCV_uf$GENEID)

tumor_adjacent_HBV_uf_abbr <- tumor_adjacent_HBV_uf[which((tumor_adjacent_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_HBV_uf$logFC>0 & tumor_adjacent_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_HCV_uf$logFC>0) | (tumor_adjacent_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_HBV_uf$logFC<0 & tumor_adjacent_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_HCV_uf$logFC<0)),]
tumor_adjacent_HCV_uf_abbr <- tumor_adjacent_HCV_uf[which((tumor_adjacent_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_HBV_uf$logFC>0 & tumor_adjacent_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_HCV_uf$logFC>0) | (tumor_adjacent_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_HBV_uf$logFC<0 & tumor_adjacent_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_HCV_uf$logFC<0)),]
identical(tumor_adjacent_HBV_uf_abbr$GENEID, tumor_adjacent_HCV_uf_abbr$GENEID)

plot <- cbind(tumor_adjacent_HBV_uf_abbr, tumor_adjacent_HCV_uf_abbr$logFC)

ggplot(plot, aes(x=logFC, y=`tumor_adjacent_HCV_uf_abbr$logFC`)) + geom_point(color="goldenrod") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$logFC > 5 | plot$logFC < -5),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100) + xlim(-9, 9) + ylim(-9,9)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/HBV_HCV_Significant_same_dir_LogFC.pdf", width=7, height=7)
ggplot(plot, aes(x=logFC, y=`tumor_adjacent_HCV_uf_abbr$logFC`)) + geom_point(color="goldenrod") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$logFC > 5 | plot$logFC < -5),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100) + xlim(-9, 9) + ylim(-9,9)
dev.off()
```

## Significnat in both, opposite direction
```{r}
tumor_adjacent_HBV_uf_abbr <- tumor_adjacent_HBV_uf[which((tumor_adjacent_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_HBV_uf$logFC<0 & tumor_adjacent_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_HCV_uf$logFC>0) | (tumor_adjacent_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_HBV_uf$logFC>0 & tumor_adjacent_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_HCV_uf$logFC<0)),]
tumor_adjacent_HCV_uf_abbr <- tumor_adjacent_HCV_uf[which((tumor_adjacent_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_HBV_uf$logFC<0 & tumor_adjacent_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_HCV_uf$logFC>0) | (tumor_adjacent_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_HBV_uf$logFC>0 & tumor_adjacent_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_HCV_uf$logFC<0)),]
identical(tumor_adjacent_HBV_uf_abbr$GENEID, tumor_adjacent_HCV_uf_abbr$GENEID)

plot <- cbind(tumor_adjacent_HBV_uf_abbr, tumor_adjacent_HCV_uf_abbr$logFC)

ggplot(plot, aes(x=logFC, y=`tumor_adjacent_HCV_uf_abbr$logFC`)) + geom_point(color="goldenrod") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$logFC > 1 | plot$logFC < -1),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100) + xlim(-4, 4) + ylim(-4,4)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/HBV_HCV_Significant_opposite_dir_LogFC.pdf", width=7, height=7)
ggplot(plot, aes(x=logFC, y=`tumor_adjacent_HCV_uf_abbr$logFC`)) + geom_point(color="goldenrod") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$logFC > 1 | plot$logFC < -1),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100) + xlim(-4, 4) + ylim(-4,4)
dev.off()
```

## Significnat in HBV only
```{r}
tumor_adjacent_HBV_uf_abbr <- tumor_adjacent_HBV_uf[which(tumor_adjacent_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_HCV_uf$adj.P.Val>=0.05),]
tumor_adjacent_HCV_uf_abbr <- tumor_adjacent_HCV_uf[which(tumor_adjacent_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_HCV_uf$adj.P.Val>=0.05),]
identical(tumor_adjacent_HBV_uf_abbr$GENEID, tumor_adjacent_HCV_uf_abbr$GENEID)

plot <- cbind(tumor_adjacent_HBV_uf_abbr, tumor_adjacent_HCV_uf_abbr$logFC)

ggplot(plot, aes(x=logFC, y=`tumor_adjacent_HCV_uf_abbr$logFC`)) + geom_point(color="darkgreen") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$logFC > 2 | plot$logFC < -2),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100) + xlim(-5, 5) + ylim(-5,5)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/HBV_only_Significant_LogFC.pdf", width=7, height=7)
ggplot(plot, aes(x=logFC, y=`tumor_adjacent_HCV_uf_abbr$logFC`)) + geom_point(color="darkgreen") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$logFC > 2 | plot$logFC < -2),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100) + xlim(-5, 5) + ylim(-5,5)
dev.off()
```

## Significnat in HCV only
```{r}
tumor_adjacent_HBV_uf_abbr <- tumor_adjacent_HBV_uf[which(tumor_adjacent_HBV_uf$adj.P.Val>=0.05 & tumor_adjacent_HCV_uf$adj.P.Val<0.05),]
tumor_adjacent_HCV_uf_abbr <- tumor_adjacent_HCV_uf[which(tumor_adjacent_HBV_uf$adj.P.Val>=0.05 & tumor_adjacent_HCV_uf$adj.P.Val<0.05),]
identical(tumor_adjacent_HBV_uf_abbr$GENEID, tumor_adjacent_HCV_uf_abbr$GENEID)

plot <- cbind(tumor_adjacent_HBV_uf_abbr, tumor_adjacent_HCV_uf_abbr$logFC)

ggplot(plot, aes(x=logFC, y=`tumor_adjacent_HCV_uf_abbr$logFC`)) + geom_point(color="firebrick") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$`tumor_adjacent_HCV_uf_abbr$logFC` > 2 | plot$`tumor_adjacent_HCV_uf_abbr$logFC` < -2),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100) + xlim(-5, 5) + ylim(-5,5)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/HCV_only_Significant_LogFC.pdf", width=7, height=7)
ggplot(plot, aes(x=logFC, y=`tumor_adjacent_HCV_uf_abbr$logFC`)) + geom_point(color="firebrick") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$`tumor_adjacent_HCV_uf_abbr$logFC` > 2 | plot$`tumor_adjacent_HCV_uf_abbr$logFC` < -2),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100) + xlim(-5, 5) + ylim(-5,5)
dev.off()
```

# Analysis stratified by sex and etiology

### Female HBV Tumor vs. Tumor_adjacent

```{r}
# Volcano plots of sex-biased gene expression in non-infected, HBV, and HCV cases

# Assigning colors to highlight genes that have an absolute fold change => 2
# and an adjusted p-value =< 0.01

# For no hepatitis
# Finding X and Y linked and autosomal genes, assigning color values
tumor_adjacent_F_HBV_uf$color <- NA
## Autosomal non-significant
tumor_adjacent_F_HBV_uf[which(!(tumor_adjacent_F_HBV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_F_HBV_uf$chr != "chrX" & tumor_adjacent_F_HBV_uf$chr != "chrY"), 15] <- 1
## X-linked non-signifiant
tumor_adjacent_F_HBV_uf[which(!(tumor_adjacent_F_HBV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_F_HBV_uf$chr == "chrX"), 15] <- 2
## Y-linked non-significant
tumor_adjacent_F_HBV_uf[which(!(tumor_adjacent_F_HBV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_F_HBV_uf$chr == "chrY"), 15] <- 3
## Autosomal significant
tumor_adjacent_F_HBV_uf[which((tumor_adjacent_F_HBV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_F_HBV_uf$chr != "chrX" & tumor_adjacent_F_HBV_uf$chr != "chrY"), 15] <- 4
## X-linked signifiant
tumor_adjacent_F_HBV_uf[which((tumor_adjacent_F_HBV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_F_HBV_uf$chr == "chrX"), 15] <- 5
## Y-linked significant
tumor_adjacent_F_HBV_uf[which((tumor_adjacent_F_HBV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_F_HBV_uf$chr == "chrY"), 15] <- 6


tumor_adjacent_F_HBV_uf$color <- as.factor(tumor_adjacent_F_HBV_uf$color)

# Constructing the plot object. The colors will not work the way they should if
# one of the groups doesn't have any genes
# "azure3", "pink", "seagreen2", "black", "mediumvioletred", "springgreen"
p <- ggplot(data = tumor_adjacent_F_HBV_uf, aes(x = logFC, y = -log10(adj.P.Val), color=color )) +
  geom_point(alpha = 0.5, size = 5) +
  theme_bw() +
  theme(legend.position = "none") +
  xlim(c(-8, 8)) + ylim(c(0, 75)) +
  scale_color_manual(values = c("azure3", "pink", "seagreen2", "black", "mediumvioletred", "springgreen")) +
  labs(x=expression(log[2](FC)),
       y=expression(-log[10] ~ "(FDR-adjusted " ~ italic("p") ~ "-value)")) +
  theme(axis.title.x=element_text(size=12), 
        axis.text.x=element_text(size=10)) +
  theme(axis.title.y=element_text(size=12),
        axis.text.y=element_text(size=10))

forLabel <- subset(tumor_adjacent_F_HBV_uf, adj.P.Val<=0.01 & abs(logFC)>=2)

# Adding lines for significance thresholds
p + geom_hline(yintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = -2, colour="#000000", linetype="dashed"
) + geom_text_repel(data=forLabel, max.iter=1000, box.padding = 0.25, force=1, aes(x = logFC, y = -log10(adj.P.Val), label=gene_name, color=color), size=9)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/Tumor_adjacent_F_HBV_volcano.pdf", width=12, height=12)
p + geom_hline(yintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = -2, colour="#000000", linetype="dashed"
) + geom_text_repel(data=forLabel, max.iter=1000, box.padding = 0.25, force=1, aes(x = logFC, y = -log10(adj.P.Val), label=gene_name, color=color), size=9)
dev.off()
```

### Female HCV Tumor vs. Tumor_adjacent

```{r}
# Volcano plots of sex-biased gene expression in non-infected, HBV, and HCV cases

# Assigning colors to highlight genes that have an absolute fold change => 2
# and an adjusted p-value =< 0.01

# For no hepatitis
# Finding X and Y linked and autosomal genes, assigning color values
tumor_adjacent_F_HCV_uf$color <- NA
## Autosomal non-significant
tumor_adjacent_F_HCV_uf[which(!(tumor_adjacent_F_HCV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_F_HCV_uf$chr != "chrX" & tumor_adjacent_F_HCV_uf$chr != "chrY"), 15] <- 1
## X-linked non-signifiant
tumor_adjacent_F_HCV_uf[which(!(tumor_adjacent_F_HCV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_F_HCV_uf$chr == "chrX"), 15] <- 2
## Y-linked non-significant
tumor_adjacent_F_HCV_uf[which(!(tumor_adjacent_F_HCV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_F_HCV_uf$chr == "chrY"), 15] <- 3
## Autosomal significant
tumor_adjacent_F_HCV_uf[which((tumor_adjacent_F_HCV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_F_HCV_uf$chr != "chrX" & tumor_adjacent_F_HCV_uf$chr != "chrY"), 15] <- 4
## X-linked signifiant
tumor_adjacent_F_HCV_uf[which((tumor_adjacent_F_HCV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_F_HCV_uf$chr == "chrX"), 15] <- 5
## Y-linked significant
tumor_adjacent_F_HCV_uf[which((tumor_adjacent_F_HCV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_F_HCV_uf$chr == "chrY"), 15] <- 6


tumor_adjacent_F_HCV_uf$color <- as.factor(tumor_adjacent_F_HCV_uf$color)

# Constructing the plot object. The colors will not work the way they should if
# one of the groups doesn't have any genes
# "azure3", "pink", "seagreen2", "black", "mediumvioletred", "springgreen"
p <- ggplot(data = tumor_adjacent_F_HCV_uf, aes(x = logFC, y = -log10(adj.P.Val), color=color )) +
  geom_point(alpha = 0.5, size = 5) +
  theme_bw() +
  theme(legend.position = "none") +
  xlim(c(-8, 8)) + ylim(c(0, 75)) +
  scale_color_manual(values = c("azure3", "pink", "seagreen2", "black", "mediumvioletred", "springgreen")) +
  labs(x=expression(log[2](FC)),
       y=expression(-log[10] ~ "(FDR-adjusted " ~ italic("p") ~ "-value)")) +
  theme(axis.title.x=element_text(size=12), 
        axis.text.x=element_text(size=10)) +
  theme(axis.title.y=element_text(size=12),
        axis.text.y=element_text(size=10))

forLabel <- subset(tumor_adjacent_F_HCV_uf, adj.P.Val<=0.01 & abs(logFC)>=2)

# Adding lines for significance thresholds
p + geom_hline(yintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = -2, colour="#000000", linetype="dashed"
) + geom_text_repel(data=forLabel, max.iter=1000, box.padding = 0.25, force=1, aes(x = logFC, y = -log10(adj.P.Val), label=gene_name, color=color), size=9)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/Tumor_adjacent_F_HCV_volcano.pdf", width=12, height=12)
p + geom_hline(yintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = -2, colour="#000000", linetype="dashed"
) + geom_text_repel(data=forLabel, max.iter=1000, box.padding = 0.25, force=1, aes(x = logFC, y = -log10(adj.P.Val), label=gene_name, color=color), size=9)
dev.off()
```

# Analysis stratified by sex and etiology

### Male HBV Tumor vs. Tumor_adjacent

```{r}
# Volcano plots of sex-biased gene expression in non-infected, HBV, and HCV cases

# Assigning colors to highlight genes that have an absolute fold change => 2
# and an adjusted p-value =< 0.01

# For no hepatitis
# Finding X and Y linked and autosomal genes, assigning color values
tumor_adjacent_M_HBV_uf$color <- NA
## Autosomal non-significant
tumor_adjacent_M_HBV_uf[which(!(tumor_adjacent_M_HBV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_M_HBV_uf$chr != "chrX" & tumor_adjacent_M_HBV_uf$chr != "chrY"), 15] <- 1
## X-linked non-signifiant
tumor_adjacent_M_HBV_uf[which(!(tumor_adjacent_M_HBV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_M_HBV_uf$chr == "chrX"), 15] <- 2
## Y-linked non-significant
tumor_adjacent_M_HBV_uf[which(!(tumor_adjacent_M_HBV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_M_HBV_uf$chr == "chrY"), 15] <- 3
## Autosomal significant
tumor_adjacent_M_HBV_uf[which((tumor_adjacent_M_HBV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_M_HBV_uf$chr != "chrX" & tumor_adjacent_M_HBV_uf$chr != "chrY"), 15] <- 4
## X-linked signifiant
tumor_adjacent_M_HBV_uf[which((tumor_adjacent_M_HBV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_M_HBV_uf$chr == "chrX"), 15] <- 5
## Y-linked significant
tumor_adjacent_M_HBV_uf[which((tumor_adjacent_M_HBV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_M_HBV_uf$chr == "chrY"), 15] <- 6


tumor_adjacent_M_HBV_uf$color <- as.factor(tumor_adjacent_M_HBV_uf$color)

# Constructing the plot object. The colors will not work the way they should if
# one of the groups doesn't have any genes
# "azure3", "pink", "seagreen2", "black", "mediumvioletred", "springgreen"
p <- ggplot(data = tumor_adjacent_M_HBV_uf, aes(x = logFC, y = -log10(adj.P.Val), color=color )) +
  geom_point(alpha = 0.5, size = 5) +
  theme_bw() +
  theme(legend.position = "none") +
  xlim(c(-8, 8)) + ylim(c(0, 75)) +
  scale_color_manual(values = c("azure3", "pink", "seagreen2", "black", "mediumvioletred", "springgreen")) +
  labs(x=expression(log[2](FC)),
       y=expression(-log[10] ~ "(FDR-adjusted " ~ italic("p") ~ "-value)")) +
  theme(axis.title.x=element_text(size=12), 
        axis.text.x=element_text(size=10)) +
  theme(axis.title.y=element_text(size=12),
        axis.text.y=element_text(size=10))

forLabel <- subset(tumor_adjacent_M_HBV_uf, adj.P.Val<=0.01 & abs(logFC)>=2)

# Adding lines for significance thresholds
p + geom_hline(yintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = -2, colour="#000000", linetype="dashed"
) + geom_text_repel(data=forLabel, max.iter=1000, box.padding = 0.25, force=1, aes(x = logFC, y = -log10(adj.P.Val), label=gene_name, color=color), size=9)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/Tumor_adjacent_M_HBV_volcano.pdf", width=12, height=12)
p + geom_hline(yintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = -2, colour="#000000", linetype="dashed"
) + geom_text_repel(data=forLabel, max.iter=1000, box.padding = 0.25, force=1, aes(x = logFC, y = -log10(adj.P.Val), label=gene_name, color=color), size=9)
dev.off()
```

### Male HCV Tumor vs. Tumor_adjacent

```{r}
# Volcano plots of sex-biased gene expression in non-infected, HBV, and HCV cases

# Assigning colors to highlight genes that have an absolute fold change => 2
# and an adjusted p-value =< 0.01

# For no hepatitis
# Finding X and Y linked and autosomal genes, assigning color values
tumor_adjacent_M_HCV_uf$color <- NA
## Autosomal non-significant
tumor_adjacent_M_HCV_uf[which(!(tumor_adjacent_M_HCV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_M_HCV_uf$chr != "chrX" & tumor_adjacent_M_HCV_uf$chr != "chrY"), 15] <- 1
## X-linked non-signifiant
tumor_adjacent_M_HCV_uf[which(!(tumor_adjacent_M_HCV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_M_HCV_uf$chr == "chrX"), 15] <- 2
## Y-linked non-significant
tumor_adjacent_M_HCV_uf[which(!(tumor_adjacent_M_HCV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_M_HCV_uf$chr == "chrY"), 15] <- 3
## Autosomal significant
tumor_adjacent_M_HCV_uf[which((tumor_adjacent_M_HCV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_M_HCV_uf$chr != "chrX" & tumor_adjacent_M_HCV_uf$chr != "chrY"), 15] <- 4
## X-linked signifiant
tumor_adjacent_M_HCV_uf[which((tumor_adjacent_M_HCV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_M_HCV_uf$chr == "chrX"), 15] <- 5
## Y-linked significant
tumor_adjacent_M_HCV_uf[which((tumor_adjacent_M_HCV_uf$GENEID %in% tumor_adjacent_HBV$DEGs.GENEID) & tumor_adjacent_M_HCV_uf$chr == "chrY"), 15] <- 6


tumor_adjacent_M_HCV_uf$color <- as.factor(tumor_adjacent_M_HCV_uf$color)

# Constructing the plot object. The colors will not work the way they should if
# one of the groups doesn't have any genes
# "azure3", "pink", "seagreen2", "black", "mediumvioletred", "springgreen"
p <- ggplot(data = tumor_adjacent_M_HCV_uf, aes(x = logFC, y = -log10(adj.P.Val), color=color )) +
  geom_point(alpha = 0.5, size = 5) +
  theme_bw() +
  theme(legend.position = "none") +
  xlim(c(-8, 8)) + ylim(c(0, 75)) +
  scale_color_manual(values = c("azure3", "pink", "seagreen2", "black", "mediumvioletred", "springgreen")) +
  labs(x=expression(log[2](FC)),
       y=expression(-log[10] ~ "(FDR-adjusted " ~ italic("p") ~ "-value)")) +
  theme(axis.title.x=element_text(size=12), 
        axis.text.x=element_text(size=10)) +
  theme(axis.title.y=element_text(size=12),
        axis.text.y=element_text(size=10))

forLabel <- subset(tumor_adjacent_M_HCV_uf, adj.P.Val<=0.01 & abs(logFC)>=2)

# Adding lines for significance thresholds
p + geom_hline(yintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = -2, colour="#000000", linetype="dashed"
) + geom_text_repel(data=forLabel, max.iter=1000, box.padding = 0.25, force=1, aes(x = logFC, y = -log10(adj.P.Val), label=gene_name, color=color), size=9)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/Tumor_adjacent_M_HCV_volcano.pdf", width=12, height=12)
p + geom_hline(yintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = 2, colour="#000000", linetype="dashed"
) + geom_vline(xintercept = -2, colour="#000000", linetype="dashed"
) + geom_text_repel(data=forLabel, max.iter=1000, box.padding = 0.25, force=1, aes(x = logFC, y = -log10(adj.P.Val), label=gene_name, color=color), size=9)
dev.off()
```

# Upset plots

# Male vs. female HBV

```{r}
upset_list <- list("Up Overall"= tumor_adjacent_HBV_uf[which(tumor_adjacent_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_HBV_uf$logFC>0),1], 
                   "Up Female"=tumor_adjacent_F_HBV_uf[which(tumor_adjacent_F_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HBV_uf$logFC>0),1],
                   "Up Male"=tumor_adjacent_M_HBV_uf[which(tumor_adjacent_M_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_M_HBV_uf$logFC>0),1],
                   "Down Overall"= tumor_adjacent_HBV_uf[which(tumor_adjacent_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_HBV_uf$logFC<0),1], 
                   "Down Female"=tumor_adjacent_F_HBV_uf[which(tumor_adjacent_F_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HBV_uf$logFC<0),1],
                   "Down Male"=tumor_adjacent_M_HBV_uf[which(tumor_adjacent_M_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_M_HBV_uf$logFC<0),1])
upset(fromList(upset_list), order.by = "freq", sets=c("Up Overall", "Up Female", "Up Male",
                                                      "Down Overall", "Down Female", "Down Male"), nsets=6, keep.order = TRUE)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/Tumor_adjacent_Male_Female_HBV_Upset.pdf", width=10, height=10)
upset(fromList(upset_list), order.by = "freq", sets=c("Up Overall", "Up Female", "Up Male",
                                                      "Down Overall", "Down Female", "Down Male"), nsets=6, keep.order = TRUE)
dev.off()
```

# Male vs. female HCV

```{r}
upset_list <- list("Up Overall"= tumor_adjacent_HCV_uf[which(tumor_adjacent_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_HCV_uf$logFC>0),1], 
                   "Up Female"=tumor_adjacent_F_HCV_uf[which(tumor_adjacent_F_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HCV_uf$logFC>0),1],
                   "Up Male"=tumor_adjacent_M_HCV_uf[which(tumor_adjacent_M_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_M_HCV_uf$logFC>0),1],
                   "Down Overall"= tumor_adjacent_HCV_uf[which(tumor_adjacent_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_HCV_uf$logFC<0),1], 
                   "Down Female"=tumor_adjacent_F_HCV_uf[which(tumor_adjacent_F_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HCV_uf$logFC<0),1],
                   "Down Male"=tumor_adjacent_M_HCV_uf[which(tumor_adjacent_M_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_M_HCV_uf$logFC<0),1])
upset(fromList(upset_list), order.by = "freq", sets=c("Up Overall", "Up Female", "Up Male",
                                                      "Down Overall", "Down Female", "Down Male"), nsets=6, keep.order = TRUE)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/Tumor_adjacent_Male_Female_HCV_Upset.pdf", width=10, height=10)
upset(fromList(upset_list), order.by = "freq", sets=c("Up Overall", "Up Female", "Up Male",
                                                      "Down Overall", "Down Female", "Down Male"), nsets=6, keep.order = TRUE)
dev.off()
```

# LogFC plots HBV M vs HBV F

## Significnat in both, same direction
```{r}
tumor_adjacent_M_HBV_uf <- tumor_adjacent_M_HBV_uf[match(tumor_adjacent_F_HBV_uf$GENEID, tumor_adjacent_M_HBV_uf$GENEID),]
identical(tumor_adjacent_M_HBV_uf$GENEID, tumor_adjacent_F_HBV_uf$GENEID)

tumor_adjacent_M_HBV_uf_abbr <- tumor_adjacent_M_HBV_uf[which((tumor_adjacent_M_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_M_HBV_uf$logFC>0 & tumor_adjacent_F_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HBV_uf$logFC>0) | (tumor_adjacent_M_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_M_HBV_uf$logFC<0 & tumor_adjacent_F_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HBV_uf$logFC<0)),]
tumor_adjacent_F_HBV_uf_abbr <- tumor_adjacent_F_HBV_uf[which((tumor_adjacent_M_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_M_HBV_uf$logFC>0 & tumor_adjacent_F_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HBV_uf$logFC>0) | (tumor_adjacent_M_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_M_HBV_uf$logFC<0 & tumor_adjacent_F_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HBV_uf$logFC<0)),]
identical(tumor_adjacent_M_HBV_uf_abbr$GENEID, tumor_adjacent_F_HBV_uf_abbr$GENEID)

plot <- cbind(tumor_adjacent_F_HBV_uf_abbr, tumor_adjacent_M_HBV_uf_abbr$logFC)

ggplot(plot, aes(x=logFC, y=`tumor_adjacent_M_HBV_uf_abbr$logFC`)) + geom_point(color="goldenrod") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$logFC > 5 | plot$logFC < -5),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/HBV_MvF_Significant_same_dir_LogFC.pdf", width=7, height=7)
ggplot(plot, aes(x=logFC, y=`tumor_adjacent_M_HBV_uf_abbr$logFC`)) + geom_point(color="goldenrod") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$logFC > 5 | plot$logFC < -5),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100)
dev.off()
```

## Significnat in both, opposite direction
```{r}
tumor_adjacent_M_HBV_uf <- tumor_adjacent_M_HBV_uf[match(tumor_adjacent_F_HBV_uf$GENEID, tumor_adjacent_M_HBV_uf$GENEID),]
identical(tumor_adjacent_M_HBV_uf$GENEID, tumor_adjacent_F_HBV_uf$GENEID)

tumor_adjacent_M_HBV_uf_abbr <- tumor_adjacent_M_HBV_uf[which((tumor_adjacent_M_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_M_HBV_uf$logFC<0 & tumor_adjacent_F_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HBV_uf$logFC>0) | (tumor_adjacent_M_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_M_HBV_uf$logFC>0 & tumor_adjacent_F_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HBV_uf$logFC<0)),]
tumor_adjacent_F_HBV_uf_abbr <- tumor_adjacent_F_HBV_uf[which((tumor_adjacent_M_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_M_HBV_uf$logFC<0 & tumor_adjacent_F_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HBV_uf$logFC>0) | (tumor_adjacent_M_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_M_HBV_uf$logFC>0 & tumor_adjacent_F_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HBV_uf$logFC<0)),]
identical(tumor_adjacent_M_HBV_uf_abbr$GENEID, tumor_adjacent_F_HBV_uf_abbr$GENEID)

plot <- cbind(tumor_adjacent_F_HBV_uf_abbr, tumor_adjacent_M_HBV_uf_abbr$logFC)

ggplot(plot, aes(x=logFC, y=`tumor_adjacent_M_HBV_uf_abbr$logFC`)) + geom_point(color="goldenrod") + theme_minimal() + 
  geom_text_repel(data=plot, aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/HBV_MvF_Significant_opposite_dir_LogFC.pdf", width=7, height=7)
ggplot(plot, aes(x=logFC, y=`tumor_adjacent_M_HBV_uf_abbr$logFC`)) + geom_point(color="goldenrod") + theme_minimal() + 
  geom_text_repel(data=plot, aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100)
dev.off()
```

## Significnat M HBV only
```{r}
tumor_adjacent_M_HBV_uf <- tumor_adjacent_M_HBV_uf[match(tumor_adjacent_F_HBV_uf$GENEID, tumor_adjacent_M_HBV_uf$GENEID),]
identical(tumor_adjacent_M_HBV_uf$GENEID, tumor_adjacent_F_HBV_uf$GENEID)

tumor_adjacent_M_HBV_uf_abbr <- tumor_adjacent_M_HBV_uf[which(tumor_adjacent_M_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HBV_uf$adj.P.Val>0.05),]
tumor_adjacent_F_HBV_uf_abbr <- tumor_adjacent_F_HBV_uf[which(tumor_adjacent_M_HBV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HBV_uf$adj.P.Val>0.05),]
identical(tumor_adjacent_M_HBV_uf_abbr$GENEID, tumor_adjacent_F_HBV_uf_abbr$GENEID)

plot <- cbind(tumor_adjacent_F_HBV_uf_abbr, tumor_adjacent_M_HBV_uf_abbr$logFC)

ggplot(plot, aes(x=logFC, y=`tumor_adjacent_M_HBV_uf_abbr$logFC`)) + geom_point(color="darkgreen") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$`tumor_adjacent_M_HBV_uf_abbr$logFC` >3 | plot$`tumor_adjacent_M_HBV_uf_abbr$logFC` < -3),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/HBV_M_Significant_only.pdf", width=7, height=7)
ggplot(plot, aes(x=logFC, y=`tumor_adjacent_M_HBV_uf_abbr$logFC`)) + geom_point(color="darkgreen") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$`tumor_adjacent_M_HBV_uf_abbr$logFC` >3 | plot$`tumor_adjacent_M_HBV_uf_abbr$logFC` < -3),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100)
dev.off()
```

## Significnat F HBV only
```{r}
tumor_adjacent_M_HBV_uf <- tumor_adjacent_M_HBV_uf[match(tumor_adjacent_F_HBV_uf$GENEID, tumor_adjacent_M_HBV_uf$GENEID),]
identical(tumor_adjacent_M_HBV_uf$GENEID, tumor_adjacent_F_HBV_uf$GENEID)

tumor_adjacent_M_HBV_uf_abbr <- tumor_adjacent_M_HBV_uf[which(tumor_adjacent_M_HBV_uf$adj.P.Val>0.05 & tumor_adjacent_F_HBV_uf$adj.P.Val<0.05),]
tumor_adjacent_F_HBV_uf_abbr <- tumor_adjacent_F_HBV_uf[which(tumor_adjacent_M_HBV_uf$adj.P.Val>0.05 & tumor_adjacent_F_HBV_uf$adj.P.Val<0.05),]
identical(tumor_adjacent_M_HBV_uf_abbr$GENEID, tumor_adjacent_F_HBV_uf_abbr$GENEID)

plot <- cbind(tumor_adjacent_F_HBV_uf_abbr, tumor_adjacent_M_HBV_uf_abbr$logFC)

ggplot(plot, aes(x=logFC, y=`tumor_adjacent_M_HBV_uf_abbr$logFC`)) + geom_point(color="firebrick") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$logFC >2 | plot$logFC < -2),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/HBV_F_Significant_only.pdf", width=7, height=7)
ggplot(plot, aes(x=logFC, y=`tumor_adjacent_M_HBV_uf_abbr$logFC`)) + geom_point(color="firebrick") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$logFC >2 | plot$logFC < -2),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100)
dev.off()
```

# LogFC plots HCV M vs HCV F

## Significnat in both, same direction
```{r}
tumor_adjacent_M_HCV_uf <- tumor_adjacent_M_HCV_uf[match(tumor_adjacent_F_HCV_uf$GENEID, tumor_adjacent_M_HCV_uf$GENEID),]
identical(tumor_adjacent_M_HCV_uf$GENEID, tumor_adjacent_F_HCV_uf$GENEID)

tumor_adjacent_M_HCV_uf_abbr <- tumor_adjacent_M_HCV_uf[which((tumor_adjacent_M_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_M_HCV_uf$logFC>0 & tumor_adjacent_F_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HCV_uf$logFC>0) | (tumor_adjacent_M_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_M_HCV_uf$logFC<0 & tumor_adjacent_F_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HCV_uf$logFC<0)),]
tumor_adjacent_F_HCV_uf_abbr <- tumor_adjacent_F_HCV_uf[which((tumor_adjacent_M_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_M_HCV_uf$logFC>0 & tumor_adjacent_F_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HCV_uf$logFC>0) | (tumor_adjacent_M_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_M_HCV_uf$logFC<0 & tumor_adjacent_F_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HCV_uf$logFC<0)),]
identical(tumor_adjacent_M_HCV_uf_abbr$GENEID, tumor_adjacent_F_HCV_uf_abbr$GENEID)

plot <- cbind(tumor_adjacent_F_HCV_uf_abbr, tumor_adjacent_M_HCV_uf_abbr$logFC)

ggplot(plot, aes(x=logFC, y=`tumor_adjacent_M_HCV_uf_abbr$logFC`)) + geom_point(color="goldenrod") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$logFC >5 | plot$logFC < -5),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/HCV_MvF_Significant_same_dir_LogFC.pdf", width=7, height=7)
ggplot(plot, aes(x=logFC, y=`tumor_adjacent_M_HCV_uf_abbr$logFC`)) + geom_point(color="goldenrod") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$logFC >5 | plot$logFC < -5),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100)
dev.off()
```

## Significnat in both, opposite direction
```{r}
tumor_adjacent_M_HCV_uf <- tumor_adjacent_M_HCV_uf[match(tumor_adjacent_F_HCV_uf$GENEID, tumor_adjacent_M_HCV_uf$GENEID),]
identical(tumor_adjacent_M_HCV_uf$GENEID, tumor_adjacent_F_HCV_uf$GENEID)

tumor_adjacent_M_HCV_uf_abbr <- tumor_adjacent_M_HCV_uf[which((tumor_adjacent_M_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_M_HCV_uf$logFC<0 & tumor_adjacent_F_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HCV_uf$logFC>0) | (tumor_adjacent_M_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_M_HCV_uf$logFC>0 & tumor_adjacent_F_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HCV_uf$logFC<0)),]
tumor_adjacent_F_HCV_uf_abbr <- tumor_adjacent_F_HCV_uf[which((tumor_adjacent_M_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_M_HCV_uf$logFC<0 & tumor_adjacent_F_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HCV_uf$logFC>0) | (tumor_adjacent_M_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_M_HCV_uf$logFC>0 & tumor_adjacent_F_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HCV_uf$logFC<0)),]
identical(tumor_adjacent_M_HCV_uf_abbr$GENEID, tumor_adjacent_F_HCV_uf_abbr$GENEID)

plot <- cbind(tumor_adjacent_F_HCV_uf_abbr, tumor_adjacent_M_HCV_uf_abbr$logFC)

ggplot(plot, aes(x=logFC, y=`tumor_adjacent_M_HCV_uf_abbr$logFC`)) + geom_point(color="goldenrod") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$logFC >0 | plot$logFC < -0),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/HCV_MvF_Significant_opposite_dir_LogFC.pdf", width=7, height=7)
ggplot(plot, aes(x=logFC, y=`tumor_adjacent_M_HCV_uf_abbr$logFC`)) + geom_point(color="goldenrod") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$logFC >0 | plot$logFC < -0),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100)
dev.off()
```

## Significnat M HCV only
```{r}
tumor_adjacent_M_HCV_uf <- tumor_adjacent_M_HCV_uf[match(tumor_adjacent_F_HCV_uf$GENEID, tumor_adjacent_M_HCV_uf$GENEID),]
identical(tumor_adjacent_M_HCV_uf$GENEID, tumor_adjacent_F_HCV_uf$GENEID)

tumor_adjacent_M_HCV_uf_abbr <- tumor_adjacent_M_HCV_uf[which(tumor_adjacent_M_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HCV_uf$adj.P.Val>0.05),]
tumor_adjacent_F_HCV_uf_abbr <- tumor_adjacent_F_HCV_uf[which(tumor_adjacent_M_HCV_uf$adj.P.Val<0.05 & tumor_adjacent_F_HCV_uf$adj.P.Val>0.05),]
identical(tumor_adjacent_M_HCV_uf_abbr$GENEID, tumor_adjacent_F_HCV_uf_abbr$GENEID)

plot <- cbind(tumor_adjacent_F_HCV_uf_abbr, tumor_adjacent_M_HCV_uf_abbr$logFC)

ggplot(plot, aes(x=logFC, y=`tumor_adjacent_M_HCV_uf_abbr$logFC`)) + geom_point(color="darkgreen") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$`tumor_adjacent_M_HCV_uf_abbr$logFC` >2 | plot$`tumor_adjacent_M_HCV_uf_abbr$logFC` < -2),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/HCV_M_Significant_only.pdf", width=7, height=7)
ggplot(plot, aes(x=logFC, y=`tumor_adjacent_M_HCV_uf_abbr$logFC`)) + geom_point(color="darkgreen") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$`tumor_adjacent_M_HCV_uf_abbr$logFC` >2 | plot$`tumor_adjacent_M_HCV_uf_abbr$logFC` < -2),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100)
dev.off()
```

## Significnat F HCV only
```{r}
tumor_adjacent_M_HCV_uf <- tumor_adjacent_M_HCV_uf[match(tumor_adjacent_F_HCV_uf$GENEID, tumor_adjacent_M_HCV_uf$GENEID),]
identical(tumor_adjacent_M_HCV_uf$GENEID, tumor_adjacent_F_HCV_uf$GENEID)

tumor_adjacent_M_HCV_uf_abbr <- tumor_adjacent_M_HCV_uf[which(tumor_adjacent_M_HCV_uf$adj.P.Val>0.05 & tumor_adjacent_F_HCV_uf$adj.P.Val<0.05),]
tumor_adjacent_F_HCV_uf_abbr <- tumor_adjacent_F_HCV_uf[which(tumor_adjacent_M_HCV_uf$adj.P.Val>0.05 & tumor_adjacent_F_HCV_uf$adj.P.Val<0.05),]
identical(tumor_adjacent_M_HCV_uf_abbr$GENEID, tumor_adjacent_F_HCV_uf_abbr$GENEID)

plot <- cbind(tumor_adjacent_F_HCV_uf_abbr, tumor_adjacent_M_HCV_uf_abbr$logFC)

ggplot(plot, aes(x=logFC, y=`tumor_adjacent_M_HCV_uf_abbr$logFC`)) + geom_point(color="firebrick") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$logFC >1 | plot$logFC < -1),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100)

pdf("~/3.0 Hasting Research/Liver Cancer Analysis/DEG Figures/HCV_F_Significant_only.pdf", width=7, height=7)
ggplot(plot, aes(x=logFC, y=`tumor_adjacent_M_HCV_uf_abbr$logFC`)) + geom_point(color="firebrick") + theme_minimal() + 
  geom_text_repel(data=plot[which(plot$logFC >1 | plot$logFC < -1),], aes(label=gene_name, vjust=-0.7), size=3, max.overlaps = 100)
dev.off()
```